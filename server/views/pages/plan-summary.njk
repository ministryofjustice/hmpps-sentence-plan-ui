{% extends "../partials/layout.njk" %}
{% from "govuk/components/details/macro.njk" import govukDetails %}
{% from "moj/components/sub-navigation/macro.njk" import mojSubNavigation %}
{% from "moj/components/button-menu/macro.njk" import mojButtonMenu %}
{%- from "moj/components/banner/macro.njk" import mojBanner -%}
{% from "../components/summary-card/goal-summary-card.njk" import goalSummaryCard %}

{% set locale = interpolate(locale, {
    goalCounts: {
        currentGoals: data.currentGoals.length,
        futureGoals: data.futureGoals.length
    }
}) %}

{% set pageTitle %}
    {% if errors %}
        {{ locale.page.errorTitle }}
    {% else %}
        {{ locale.page.title }}
    {% endif %}
{% endset -%}

{% set mainClasses = "app-container govuk-body" %}
{% set header = {
    type: "extended",
    items: [{
            text: locale.header.createGoalButton,
            href: "/create-goal/accommodation",
            classes: "govuk-button--secondary"
        },
        {
            text: locale.header.agreePlanButton,
            href: "/plan/" + data.planUuid + "/agree"
        }]
} %}

{% block bodyStart %}
    <div id="top"></div>
{% endblock %}

{% block content %}
<div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
        {% if data.status == 'success' %}
            {{ mojBanner({
                type: 'success',
                text: locale.notificationBanner.addedGoal,
                iconFallbackText: 'Success'
            }) }}
        {% elseif data.status == 'removed' %}
            {{ mojBanner({
                type: 'success',
                text: locale.notificationBanner.removedGoal,
                iconFallbackText: 'Success'
            }) }}
        {% elseif data.status == 'updated' %}
            {{ mojBanner({
                type: 'success',
                text: locale.notificationBanner.changedGoal,
                iconFallbackText: 'Success'
            }) }}
        {% endif %}

        <p class="govuk-body">{{ locale.addStepSuggestion }}</p>

        {{ mojSubNavigation({
          label: 'Sub navigation',
          items: [{
            text: locale.subNavigation.currentGoals,
            href: '/plan-summary?type=current',
            active: data.type != 'future'
          }, {
            text: locale.subNavigation.futureGoals,
            href: '/plan-summary?type=future',
            active: data.type == 'future'
          }]
        }) }}

        <ol class="goal-list govuk-list govuk-list--number">
            {% if data.type == 'future' %}
                {% for goal in data.futureGoals %}
                    {% set buttons = [] %}
                    {% if not loop.first %}
                        {% set buttons = buttons.concat({
                            text: locale.goalSummaryCard.buttons.moveUpButton,
                            href: "/goals/future/" + goal.uuid + "/up",
                            classes: "govuk-button--secondary"
                        }) %}
                    {% endif %}

                    {% if not loop.last %}
                        {% set buttons = buttons.concat({
                            text: locale.goalSummaryCard.buttons.moveDownButton,
                            href: "/goals/future/" + goal.uuid + "/down",
                            classes: "govuk-button--secondary"
                        }) %}
                    {% endif %}
                    <li>
                        {{ goalSummaryCard({
                            goal: goal,
                            buttons: buttons,
                            actions: [
                                {
                                    href: "/edit-goal/" + goal.uuid + "?type=future",
                                    text: locale.goalSummaryCard.actions.changeGoal
                                },
                                {
                                    href: "/add-change-steps",
                                    text: locale.goalSummaryCard.actions.addOrChangeSteps
                                },
                                {
                                    href: "/remove-goal/" + goal.uuid + "?type=future",
                                    text: locale.goalSummaryCard.actions.removeGoal
                                }
                            ]
                        }) }}
                    </li>
                {% endfor %}
            {% else %}
                {% for goal in data.currentGoals %}
                    {% set buttons = [] %}
                    {% if not loop.first %}
                        {% set buttons = buttons.concat({
                            text: locale.goalSummaryCard.buttons.moveUpButton,
                            href: "/goals/current/" + goal.uuid + "/up",
                            classes: "govuk-button--secondary"
                        }) %}
                    {% endif %}

                    {% if not loop.last %}
                        {% set buttons = buttons.concat({
                            text: locale.goalSummaryCard.buttons.moveDownButton,
                            href: "/goals/current/" + goal.uuid + "/down",
                            classes: "govuk-button--secondary"
                        }) %}
                    {% endif %}

                    <li>
                        {{ goalSummaryCard({
                            goal: goal,
                            buttons: buttons,
                            actions: [
                                {
                                    href: "/edit-goal/" + goal.uuid,
                                    text: locale.goalSummaryCard.actions.changeGoal
                                },
                                {
                                    href: "/add-change-steps",
                                    text: locale.goalSummaryCard.actions.addOrChangeSteps
                                },
                                {
                                    href: "/remove-goal/" + goal.uuid + "?type=current",
                                    text: locale.goalSummaryCard.actions.removeGoal
                                }
                            ]
                        }) }}
                    </li>
                {% endfor %}
            {% endif %}
        </ol>

        {% include "../partials/back-to-top-link.njk" %}
      </div>
</div>
{% endblock %}